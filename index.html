<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Victor Sande - A1 R</title>

<script src="script_para_html_files/header-attrs-2.29/header-attrs.js"></script>
<script src="script_para_html_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="script_para_html_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="script_para_html_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="script_para_html_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="script_para_html_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="script_para_html_files/navigation-1.1/tabsets.js"></script>
<link href="script_para_html_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="script_para_html_files/highlightjs-9.12.0/highlight.js"></script>
<link href="script_para_html_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="script_para_html_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Victor Sande - A1 R</h1>

</div>


<pre class="r"><code>library(arrow)</code></pre>
<pre><code>## Warning: pacote &#39;arrow&#39; foi compilado no R versão 4.4.3</code></pre>
<pre><code>## 
## Anexando pacote: &#39;arrow&#39;</code></pre>
<pre><code>## O seguinte objeto é mascarado por &#39;package:utils&#39;:
## 
##     timestamp</code></pre>
<pre class="r"><code>library(readxl)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ lubridate::duration() masks arrow::duration()
## ✖ dplyr::filter()       masks stats::filter()
## ✖ dplyr::lag()          masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<pre class="r"><code>library(readr)
library(purrr)
library(ggplot2)
library(here)</code></pre>
<pre><code>## here() starts at C:/Users/Victor/Documents/GitHub/Victor_Sande_Introducao_ao_R_2025.2_A1</code></pre>
<div id="função-de-tratamento-das-pnads" class="section level2">
<h2>Função de Tratamento das PNADs</h2>
<pre class="r"><code>treat_pnad &lt;- function(path, input_path,
                       dictionary_path, output_path, tipo_pnad, db) {
  
  library(magrittr)
  
  dic_correction &lt;- readr::read_table(
    input_path,
    col_names = FALSE,
    skip = 10
  ) %&gt;%
    
    dplyr::filter(stringr::str_starts(stringr::str_trim(X1), &quot;@&quot;)) %&gt;%
    dplyr::mutate(
      type = ifelse(substr(X3, 1, 1) == &quot;$&quot;, TRUE, FALSE),
      start = stringr::str_replace_all(X1, &quot;@&quot;, &quot;&quot;) %&gt;% as.numeric(),
      X3 = as.integer(chartr(&quot;$&quot;, &quot; &quot;, X3)),
      end = start + X3 - 1,
      X2 = stringr::str_to_upper(X2),
      divisor = 1
    ) %&gt;%
    dplyr::select(varname = X2, width = X3, char = type, divisor, start, end)
  
  PNADc &lt;- readr::read_fwf(
    path,
    readr::fwf_positions(
      dic_correction$start,
      dic_correction$end, dic_correction$varname)) %&gt;%
    dplyr::mutate(
      REGIAO = trunc(as.numeric(UF) / 10, 0),
      PAIS = 0
    )
  
  PNADc %&gt;%
    arrow::write_parquet(.,output_path)}</code></pre>
<p>Tratando as PNADs</p>
<pre class="r"><code>#treat_pnad(
#  path = &quot;pnadc/dados/input/visita_5/2021/PNADC_2021_visita5.txt&quot;,
#  input_path = &quot;pnadc/dados/input/visita_5/2021/input_PNADC_2021_visita5.txt&quot;,
#  dictionary_path = &quot;pnadc/dados/input/visita_5/2021/dicionario_PNADC_microdados_2021_visita5.xls&quot;, 
#  output_path = &quot;pnadc/dados/output/pnadc_vis1_trat/pnadc_anual_2021.parquet&quot;,
#  tipo_pnad = &quot;anual&quot;,
#  db = NULL
#)</code></pre>
<p>Nota: como as PNADs são muito grandes, não consegui rodar todas de
uma vez. é preciso alterar os argumentos da função para cada edição da
PNAD, de acordo com o seu caminho.</p>
</div>
<div id="cálculo-da-taxa-de-desocupação" class="section level2">
<h2>Cálculo da taxa de desocupação</h2>
<p>Agora, é possível calcular a taxa de desocupação. Antes, precisa
importar os arquivos lidos:</p>
<pre class="r"><code>dir_parq  &lt;- here(&quot;pnadc&quot;,&quot;dados&quot;,&quot;output&quot;,&quot;pnadc_vis1_trat&quot;)
arquivos  &lt;- list.files(dir_parq, pattern=&quot;\\.parquet$&quot;, full.names=TRUE)
nomes     &lt;- basename(arquivos) |&gt; str_remove(&quot;\\.parquet$&quot;)

purrr::iwalk(arquivos, ~{
  obj &lt;- read_parquet(.x, col_select = c(&quot;ANO&quot;,&quot;TRIMESTRE&quot;,&quot;UF&quot;,&quot;V1032&quot;,&quot;VD4002&quot;))
  assign(nomes[.y], obj, envir = .GlobalEnv)
})</code></pre>
<p>Partindo para o cálculo:</p>
<pre class="r"><code>#Variável de interesse: VD4002 (já selecionada)

walk(nomes, ~ {
  df &lt;- get(.x) %&gt;% 
    rename(peso = V1032,
           sit = VD4002) %&gt;% 
    filter(!is.na(sit)) %&gt;% 
    mutate(ocup = sit == 1)
  
  novo_nome &lt;- gsub(&quot;pnadc_anual_&quot;, &quot;pnadc_step1_&quot;, .x)
  assign(novo_nome, df, envir = .GlobalEnv)
})

novos_nomes &lt;- ls(pattern = &quot;^pnadc_step1_\\d{4}$&quot;)

#=====================
#Cálculo Para UFS ----
#=====================
walk(novos_nomes, ~ {
  df &lt;- get(.x) %&gt;% 
    mutate(peso = as.numeric(peso)) %&gt;% 
    group_by(UF) %&gt;%
    mutate(
      soma_ocup = sum(if_else(ocup == TRUE, peso, 0)),
      soma_desocup = sum(if_else(ocup == FALSE, peso, 0)),
      total = soma_ocup + soma_desocup
    ) %&gt;%
    mutate(tx_desocup = soma_desocup / total) %&gt;% 
    ungroup() %&gt;% 
    distinct(UF, .keep_all = TRUE)
  
  novo_nome &lt;- gsub(&quot;pnadc_step1_&quot;, &quot;pnadc_ufs_&quot;, .x)
  assign(novo_nome, df, envir = .GlobalEnv)
})

#===========================================
#Cálculo para Regiões, a partir das UFs ----
#===========================================

novos_nomes_2 &lt;- ls(pattern = &quot;^pnadc_ufs_\\d{4}$&quot;)

walk(novos_nomes_2, ~ {
  df &lt;- get(.x) %&gt;%
    mutate(
      UF = substr(as.character(UF), 1, 1)  
    ) %&gt;%
    group_by(UF, ANO) %&gt;%
    mutate(
      soma_ocup = sum(soma_ocup, na.rm = TRUE),
      soma_desocup = sum(soma_desocup, na.rm = TRUE),
      total = soma_ocup + soma_desocup
    ) %&gt;%
    mutate(tx_desocup = soma_desocup / total) %&gt;% 
    ungroup() %&gt;% 
    distinct(UF, .keep_all = TRUE)
  
  novo_nome &lt;- gsub(&quot;pnadc_ufs_&quot;, &quot;pnadc_reg_&quot;, .x)
  assign(novo_nome, df, envir = .GlobalEnv)
})

#=======================
#Cálculo pro Brasil ----
#=======================

novos_nomes_3 &lt;- ls(pattern = &quot;^pnadc_reg_\\d{4}$&quot;)

walk(novos_nomes_3, ~ {
  df &lt;- get(.x) %&gt;%
    mutate(UF = &quot;0&quot;) %&gt;% 
    mutate(
      soma_ocup = sum(soma_ocup, na.rm = TRUE),
      soma_desocup = sum(soma_desocup, na.rm = TRUE),
      total = soma_ocup + soma_desocup
    ) %&gt;%
    mutate(tx_desocup = soma_desocup / total) %&gt;% 
    distinct(UF, .keep_all = TRUE)
  
  novo_nome &lt;- gsub(&quot;pnadc_reg_&quot;, &quot;pnadc_br_&quot;, .x)
  assign(novo_nome, df, envir = .GlobalEnv)
})</code></pre>
<p>Juntando todos os anos e juntando em um df final:</p>
<pre class="r"><code>anos &lt;- ls(pattern = &quot;^pnadc_br_\\d{4}$&quot;) %&gt;% 
  str_extract(&quot;\\d{4}&quot;) %&gt;% 
  sort()

walk(anos, ~ {
  df_ufs &lt;- get(paste0(&quot;pnadc_ufs_&quot;, .x)) %&gt;% 
    mutate(UF = as.numeric(UF))
  df_reg &lt;- get(paste0(&quot;pnadc_reg_&quot;, .x)) %&gt;% 
    mutate(UF = as.numeric(UF))
  df_br  &lt;- get(paste0(&quot;pnadc_br_&quot;, .x)) %&gt;% 
    mutate(UF = as.numeric(UF))
  
  
  df_final &lt;- bind_rows(df_ufs, df_reg, df_br) %&gt;% 
    arrange(UF)
  
  assign(paste0(&quot;pnadc_total_&quot;, .x), df_final, envir = .GlobalEnv)
})

nomes_totais &lt;- ls(pattern = &quot;^pnadc_total_\\d{4}$&quot;)

pnadc_total &lt;- map_dfr(nomes_totais, ~ {
  df &lt;- get(.x)
  ano &lt;- str_extract(.x, &quot;\\d{4}&quot;)
  df$ano &lt;- as.integer(ano)
  df &lt;- df 
}) %&gt;% 
  arrange(UF) %&gt;% 
  ungroup()

pnadc_total &lt;- pnadc_total %&gt;%
  select(ano, UF, soma_ocup, soma_desocup, total, tx_desocup) %&gt;% 
  mutate(tx_desocup = tx_desocup * 100) %&gt;% 
  rename(codigo = UF)</code></pre>
<p>Tabela auxiliar (relação código-nome):</p>
<pre class="r"><code>tab_aux &lt;- read_xlsx(
  here(&quot;pnadc&quot;, &quot;dados&quot;, &quot;input&quot;, &quot;tab_aux&quot;, &quot;tabela_aux_codigo_nome.xlsx&quot;)
)
  
pnadc_total_join &lt;- pnadc_total %&gt;% 
  left_join(tab_aux, by = &quot;codigo&quot;)

pnadc_total_rename &lt;- pnadc_total_join %&gt;% 
  rename(nome_UF = nome,
         codigo_UF = codigo) %&gt;% 
  select(ano, codigo_UF, nome_UF, soma_ocup, soma_desocup, total, tx_desocup) </code></pre>
<p>Gerando um csv com o arquivo finalizado:</p>
<pre class="r"><code>write.csv(
  pnadc_total_rename,
  here::here(&quot;pnadc&quot;, &quot;dados&quot;, &quot;output&quot;, &quot;perc_pnadc_desocupacao.csv&quot;),
  fileEncoding = &quot;UTF-8&quot;,
  row.names = FALSE
)</code></pre>
</div>
<div id="gráficos" class="section level2">
<h2>Gráficos</h2>
<p>Antes, recomendaria limpar o diretório e importar o arquivo gerado
para não sobrecarregar a memória.</p>
<pre class="r"><code>df &lt;- read.csv(
  here(&quot;pnadc&quot;, &quot;dados&quot;, &quot;output&quot;, &quot;perc_pnadc_desocupacao.csv&quot;)
)</code></pre>
<ul>
<li>O primeiro gráfico será a série histórica para as regiões do
Brasil.</li>
</ul>
<pre class="r"><code>dfreg &lt;- df %&gt;% 
  filter(codigo_UF &gt; 0 &amp; codigo_UF &lt; 10)

ggplot(dfreg, aes(x = ano, y = tx_desocup, color = nome_UF, group = nome_UF)) +
  geom_line(size = 1) +
  geom_point() +
  scale_x_continuous(breaks = seq(min(df$ano), max(df$ano), by = 1)) +
  labs(
    title = &quot;Taxa de desocupação por região&quot;,
    x = &quot;Ano&quot;,
    y = &quot;Taxa (%)&quot;,
    color = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;),
    legend.position = &quot;bottom&quot;  
  )</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="script_para_html_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>É possível ver que o Nordeste concentra, historicamente, sempre a
maior taxa de desocupação; enquanto o Sul, a região com menor taxa de
desocupação. Como possível melhoria para o trabalho, poderia-se fazer
uma análise com indicadores socioeconômicos, tais como o PIB per capita,
a produtividade do trabalho etc, avaliando melhor as divergências desses
recortes.</p>
<ul>
<li>O segundo gráfico será a taxa de desocupação para a região sudeste e
suas UFs, para o ano de 2024.</li>
</ul>
<pre class="r"><code>dfsudeste &lt;- df %&gt;% 
  filter(codigo_UF &gt; 30 &amp; codigo_UF &lt; 40 | codigo_UF == 3,
         ano == 2024)


ggplot(dfsudeste, aes(x = nome_UF, y = tx_desocup, fill = nome_UF)) +
  geom_col(width = 0.6) +
  labs(
    title = &quot;Taxa de desocupação - Sudeste e seus estados (2024)&quot;,
    x = &quot;&quot;,
    y = &quot;Taxa (%)&quot;,
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = &quot;bold&quot;), 
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="script_para_html_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Embora tenha optado por avaliar somente o ano de 2024, o gráfico
mostra que Rio de Janeiro está bem acima dos demais. Isso pode
representar uma dificuldade na recuperação da crise do Covid-2019, ou
estar em linha com a série histórica da taxa.</p>
</div>
<div id="glossário-das-variáveis-e-das-bases" class="section level2">
<h2>Glossário das variáveis e das bases</h2>
<p>A base de dados utilizada foi a PNAD-C, através de seus microdados da
visita 1 – com exceção dos anos 2020 e 2021, que o módulo para o cálculo
da taxa de desemprego foi concentrado na visita 5. Link direto para
acessar a PNAD-C: <a
href="https://ftp.ibge.gov.br/Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Anual/Micro"
class="uri">https://ftp.ibge.gov.br/Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Anual/Micro</a>
dados/Visita/</p>
<p>Anos 2012-2019; 2022-2024: visita 1. Anos 2020 e 2021: visita 5.</p>
<p>A variável de interesse é a VD4002. Pelo próprio dicionário da
PNAD-C, condiz à “Condição de ocupação na semana de referência para
pessoas de 14 anos ou mais de idade”; onde “1” significa que a pessoa
está ocupada, e “0”, desocupada.</p>
<p>A tabela auxiliar, chamada de “tabela_aux_codigo_nome”, é apenas a
relação do código do recorte geográfico com seu respectivo nome, visando
a criação das legendas para os gráficos. É nesse momento em que ocorre o
Join. Essa tabela foi criada por mim mesmo, mas baseada nos códigos das
UFs, regiões, e Brasil, oficialmente adotados pelo IBGE.</p>
</div>
<div id="como-reproduzir" class="section level1">
<h1>Como reproduzir</h1>
<div id="bibliotecas-utilizadas" class="section level2">
<h2>Bibliotecas utilizadas:</h2>
<pre class="r"><code>library(arrow)
library(readxl)
library(tidyverse)
library(readr)
library(purrr)
library(ggplot2)
library(here)</code></pre>
<p>É possível fazer o knit apenas apertand o botão do Rmd.</p>
</div>
<div id="divulgação-de-ia" class="section level2">
<h2>Divulgação de IA:</h2>
<p>usei o prompt: tenho um dataframe no R. quero criar gráficos a partir
dele usando o ggplot2. uma das colunas se chama “codigo_UF” (1-5,
regiões), outra que se chama “nome_UF, a coluna de valores se
chama”tx_desocup”, e a de anos, “ano”. quero um gráfico que faz a série
histórica da taxa para essas regiões.</p>
<p>no chatgpt.</p>
<p>A parte inicial (lendo e tratando a PNAD) foi feita pelo meu chefe no
estágio, que me deu o código para um trabalho que iríamos fazer
utilizando dados da PNAD. O restante, fui eu.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
